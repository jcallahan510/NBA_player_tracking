---
title: "feature engineering"
output: html_document
---

```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(janitor)
library(moderndive)
#install.packages("LearnGeom")
library(LearnGeom)


options(scipen = 999)

`%not_in%` = Negate(`%in%`)

```

```{r message=FALSE, warning=FALSE}
shot_attempts_all <- read_csv("data/shot_attempts_all.csv")
```


```{r}
shot_attempts_all <- shot_attempts_all %>% 
  mutate(p1_xy = paste(p1_x_loc, p1_y_loc, sep = ", "),
         p1_dist_from_ball = sqrt(((ball_x_loc-p1_x_loc)^2)+((ball_y_loc-p1_y_loc)^2)),
         p2_dist_from_ball = sqrt(((ball_x_loc-p2_x_loc)^2)+((ball_y_loc-p2_y_loc)^2)),
         p3_dist_from_ball = sqrt(((ball_x_loc-p3_x_loc)^2)+((ball_y_loc-p3_y_loc)^2)),
         p4_dist_from_ball = sqrt(((ball_x_loc-p4_x_loc)^2)+((ball_y_loc-p4_y_loc)^2)),
         p5_dist_from_ball = sqrt(((ball_x_loc-p5_x_loc)^2)+((ball_y_loc-p5_y_loc)^2)),
         p6_dist_from_ball = sqrt(((ball_x_loc-p6_x_loc)^2)+((ball_y_loc-p6_y_loc)^2)),
         p7_dist_from_ball = sqrt(((ball_x_loc-p7_x_loc)^2)+((ball_y_loc-p7_y_loc)^2)),
         p8_dist_from_ball = sqrt(((ball_x_loc-p8_x_loc)^2)+((ball_y_loc-p8_y_loc)^2)),
         p9_dist_from_ball = sqrt(((ball_x_loc-p9_x_loc)^2)+((ball_y_loc-p9_y_loc)^2)),
         p10_dist_from_ball = sqrt(((ball_x_loc-p10_x_loc)^2)+((ball_y_loc-p10_y_loc)^2)),
         result = case_when(shot_type == "3PT Field Goal" & event_type == "Made Shot" ~ 3,
                            shot_type == "2PT Field Goal" & event_type == "Made Shot" ~ 2,
                            event_type == "Missed Shot" ~ 0
                            )
         )

shot_attempts_all %>% 
  mutate(p1_xy = paste(p1_x_loc, p1_y_loc, sep = ", "),
         p6_xy = paste(p6_x_loc, p6_y_loc, sep = ", "),
         hoop_xy = "5.35, 88.65",
         def_angle = Angle(hoop_xy, p1_xy, p6_xy)
         ) %>% 
  select(p1_xy, p6_xy, hoop_xy)

```





```{r}
shot_attempts_all %>% 
  mutate(def_angle = Angle())
```

```{r}
shot_attempts_all %>% 
  filter(game_id == "0021500336", player_name == "Jae Crowder", quarter == 6)
```


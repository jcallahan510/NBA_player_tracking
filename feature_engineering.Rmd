---
title: "feature engineering"
output: html_document
---

```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(janitor)
library(moderndive)
#install.packages("LearnGeom")
library(LearnGeom)
#install.packages("aspace")
library(aspace)

options(scipen = 999)

`%not_in%` = Negate(`%in%`)

```

```{r message=FALSE, warning=FALSE}
shot_attempts_all <- read_csv("data/shot_attempts_all.csv")
```


```{r}
#put this chunk in extract all file!

shot_attempts_all_dist <- shot_attempts_all %>% 
  mutate(p1_dist_from_ball = sqrt(((ball_x_loc-p1_x_loc)^2)+((ball_y_loc-p1_y_loc)^2)),
         p2_dist_from_ball = sqrt(((ball_x_loc-p2_x_loc)^2)+((ball_y_loc-p2_y_loc)^2)),
         p3_dist_from_ball = sqrt(((ball_x_loc-p3_x_loc)^2)+((ball_y_loc-p3_y_loc)^2)),
         p4_dist_from_ball = sqrt(((ball_x_loc-p4_x_loc)^2)+((ball_y_loc-p4_y_loc)^2)),
         p5_dist_from_ball = sqrt(((ball_x_loc-p5_x_loc)^2)+((ball_y_loc-p5_y_loc)^2)),
         p6_dist_from_ball = sqrt(((ball_x_loc-p6_x_loc)^2)+((ball_y_loc-p6_y_loc)^2)),
         p7_dist_from_ball = sqrt(((ball_x_loc-p7_x_loc)^2)+((ball_y_loc-p7_y_loc)^2)),
         p8_dist_from_ball = sqrt(((ball_x_loc-p8_x_loc)^2)+((ball_y_loc-p8_y_loc)^2)),
         p9_dist_from_ball = sqrt(((ball_x_loc-p9_x_loc)^2)+((ball_y_loc-p9_y_loc)^2)),
         p10_dist_from_ball = sqrt(((ball_x_loc-p10_x_loc)^2)+((ball_y_loc-p10_y_loc)^2))
         )

#write.csv(shot_attempts_all_dist, 'shot_attempts_all_dist.csv', row.names = FALSE)

```


```{r}

shot_attempts_all_nearest_def <- read_csv("data/shot_attempts_all_nearest_def.csv")

def_angle <- function(x, y, x2, y2){
  nearest_def_dist <- sqrt(((x-x2)^2) + ((y-y2)^2))
  shot_dist_from_L_hoop <- sqrt(((x-5.35)^2) + ((y-25)^2))
  shot_dist_from_R_hoop <- sqrt(((x-88.65)^2) + ((y-25)^2))
  def_dist_from_L_hoop <- sqrt(((x2-5.35)^2) + ((y2-25)^2))
  def_dist_from_R_hoop <- sqrt(((x2-88.65)^2) + ((y2-25)^2))
  shooter_to_hoop <- ifelse(shot_dist_from_L_hoop < shot_dist_from_R_hoop, shot_dist_from_L_hoop, shot_dist_from_R_hoop)
  def_hoop <- ifelse(def_dist_from_L_hoop < def_dist_from_R_hoop, def_dist_from_L_hoop, def_dist_from_R_hoop)
  def_angle <- acos_d(((nearest_def_dist^2)+(shooter_to_hoop^2)-(def_hoop^2))/(2*nearest_def_dist*shooter_to_hoop))
  return(def_angle)
  }

shooter_to_hoop <- function(x, y){
  shot_dist_from_L_hoop <- sqrt(((x-5.35)^2) + ((y-25)^2))
  shot_dist_from_R_hoop <- sqrt(((x-88.65)^2) + ((y-25)^2))
  shooter_to_hoop <- ifelse(shot_dist_from_L_hoop < shot_dist_from_R_hoop, shot_dist_from_L_hoop, shot_dist_from_R_hoop)
  return(shooter_to_hoop)
  
}

shot_attempts_final <- shot_attempts_all_nearest_def %>% 
  mutate(points = case_when(shot_type == "3PT Field Goal" & event_type == "Made Shot" ~ 3,
                            shot_type == "2PT Field Goal" & event_type == "Made Shot" ~ 2,
                            event_type == "Missed Shot" ~ 0
                            ),
         shot_type_num = ifelse(shot_type == "2PT Field Goal", 2, 3),
         shooter_to_hoop = shooter_to_hoop(shooter_x_loc, shooter_y_loc),
         nearest_def_dist = sqrt(((shooter_x_loc-nearest_def_x_loc)^2) + ((shooter_x_loc-nearest_def_y_loc)^2)),
         def_angle = def_angle(shooter_x_loc, shooter_y_loc, nearest_def_x_loc, nearest_def_y_loc)
         ) 


shot_attempts_final %>%
  filter_all(any_vars(is.na(.))) 
```


```{r}
def_angle(25.75378, 42.35926, 92.47260, 23.24975)
```




```{r}
shot_attempts_all %>% 
  mutate(def_angle = Angle())
```

```{r}
shot_attempts_all %>% 
  filter(game_id == "0021500336", player_name == "Jae Crowder", quarter == 6)
```









```{r}

# shoot <- c(0, 2)
# basket <- c(0, 0)
# def <- c(2, 0)
# 
# a <- sqrt(((basket[1]-def[1])^2)+((basket[2]-def[2])^2)) #defender to hoop
# b <- sqrt(((shoot[1]-def[1])^2)+((shoot[2]-def[2])^2)) #neaest_def_distance
# c <- sqrt(((shoot[1]-basket[1])^2)+((shoot[2]-basket[2])^2)) #shooter to hoop
# 
# acos_d(((b^2)+(c^2)-(a^2))/(2*b*c))
```


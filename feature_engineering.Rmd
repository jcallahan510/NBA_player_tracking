---
title: "feature engineering"
output: html_document
---

```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(janitor)
library(moderndive)
#install.packages("raster")
library(raster)

options(scipen = 999)

`%not_in%` = Negate(`%in%`)

```

```{r message=FALSE, warning=FALSE}
shot_attempts_batch_1 <- read_csv("shot_attempts_batch_1.csv")
shot_attempts_batch_2 <- read_csv("shot_attempts_batch_2.csv")
shot_attempts_batch_3 <- read_csv("shot_attempts_batch_3.csv")
shot_attempts_batch_4 <- read_csv("shot_attempts_batch_4.csv")
shot_attempts_batch_5 <- read_csv("shot_attempts_batch_5.csv")
```



```{r message=FALSE, warning=FALSE}
shot_attempts_all <- bind_rows(shot_attempts_batch_1, shot_attempts_batch_2, shot_attempts_batch_3, shot_attempts_batch_4, shot_attempts_batch_5) 

shot_attempts_all %>% 
  mutate_at(vars(contains("id")), funs(as.character(.))) %>% 
  mutate(game_clock = q_game_clock-(quarter*1000)) %>% 
  select(game_id, quarter, game_clock, everything()) %>% 
  distinct()


shot_attempts_all %>% 
  group_by(game_id) %>% 
  summarise(n = n()) %>% 
  arrange(-n)
```


```{r}
shot_attempts_all <- shot_attempts_all %>% 
  mutate(p1_dist_from_ball = sqrt(((ball_x_loc-p1_x_loc)^2)+((ball_y_loc-p1_y_loc)^2)),
         p2_dist_from_ball = sqrt(((ball_x_loc-p2_x_loc)^2)+((ball_y_loc-p2_y_loc)^2)),
         p3_dist_from_ball = sqrt(((ball_x_loc-p3_x_loc)^2)+((ball_y_loc-p3_y_loc)^2)),
         p4_dist_from_ball = sqrt(((ball_x_loc-p4_x_loc)^2)+((ball_y_loc-p4_y_loc)^2)),
         p5_dist_from_ball = sqrt(((ball_x_loc-p5_x_loc)^2)+((ball_y_loc-p5_y_loc)^2)),
         p6_dist_from_ball = sqrt(((ball_x_loc-p6_x_loc)^2)+((ball_y_loc-p6_y_loc)^2)),
         p7_dist_from_ball = sqrt(((ball_x_loc-p7_x_loc)^2)+((ball_y_loc-p7_y_loc)^2)),
         p8_dist_from_ball = sqrt(((ball_x_loc-p8_x_loc)^2)+((ball_y_loc-p8_y_loc)^2)),
         p9_dist_from_ball = sqrt(((ball_x_loc-p9_x_loc)^2)+((ball_y_loc-p9_y_loc)^2)),
         p10_dist_from_ball = sqrt(((ball_x_loc-p10_x_loc)^2)+((ball_y_loc-p10_y_loc)^2)),
         )



```


```{r}
shot_attempts_all %>% 
  filter(game_id == "0021500154", quarter == 4, player_name == "Victor Oladipo") %>% 
  arrange(desc(minutes_remaining), desc(seconds_remaining))



# , quarter == 4, player_name == "Langston Galloway"
```

```{r}
shot_attempts_all %>% 
  filter(game_id == "0021500336", player_name == "Jae Crowder", quarter == 6)
```

